<c-row>
  <c-col xs="12">
    <c-card class="mb-4">
      <c-card-body>
        <div class="d-flex" style="gap: 1rem;">
          <!-- Products area -->
          <div class="products-area" style="flex: 1 1 0;">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <div>
                <strong>TPV</strong>
                <div class="small text-body-secondary">Productos</div>
              </div>
              <div class="d-flex gap-2">
                <input type="search" placeholder="Buscar producto…" class="form-control form-control-sm" (input)="onProductSearch($any($event.target).value)" />
                <button cButton color="secondary" type="button" (click)="refresh()">Refrescar</button>
              </div>
            </div>

            <div class="d-flex flex-wrap products-grid" style="gap:1rem;">
              <ng-container *ngIf="filteredProducts.length; else noProducts">
                <c-card *ngFor="let p of filteredProducts; trackBy: trackByProduct" class="product-card">
                  <c-card-body class="d-flex flex-column justify-content-between">
                    <div>
                      <div class="fw-semibold">{{ p.name }}</div>
                      <div class="small text-body-secondary">{{ p.type }}</div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                      <div class="fs-5 fw-bold">Q{{ p.price | number:'1.2-2' }}</div>
                      <button cButton color="dark" size="sm" type="button" (click)="addToCart(p)">Añadir</button>
                    </div>
                  </c-card-body>
                </c-card>
              </ng-container>
              <ng-template #noProducts>
                <div class="text-body-secondary">No hay productos.</div>
              </ng-template>
            </div>
          </div>

          <!-- Cart area -->
          <div style="width: 320px;">
            <c-card class="position-sticky cart-card" style="top:1rem;">
              <c-card-header>
                <strong>Carrito</strong>
              </c-card-header>
              <c-card-body>
                <div *ngIf="!cart.length" class="text-body-secondary">El carrito está vacío.</div>
                <div *ngIf="cart.length" class="d-flex flex-column" style="gap:0.5rem;">
                  <div *ngFor="let c of cart; let i = index" class="d-flex justify-content-between align-items-center">
                    <div>
                      <div class="fw-semibold">{{ c.product.name }}</div>
                      <div class="small text-body-secondary">Q{{ c.product.price | number:'1.2-2' }}</div>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                      <input type="number" class="form-control form-control-sm" style="width:72px;" [value]="c.quantity" (change)="changeQty(i, $any($event.target).valueAsNumber)" />
                      <button cButton color="danger" size="sm" type="button" (click)="removeCartItem(i)">X</button>
                    </div>
                  </div>
                </div>

                <hr />
                <div class="d-flex justify-content-between"><div>Subtotal</div><div>Q{{ cartSubtotal | number:'1.2-2' }}</div></div>
                <div class="d-flex justify-content-between"><div>Impuestos ({{ (taxPercent*100) | number:'1.2-2' }}%)</div><div>Q{{ cartTax | number:'1.2-2' }}</div></div>
                <div class="d-flex justify-content-between fw-bold mt-2"><div>Total</div><div>Q{{ cartTotal | number:'1.2-2' }}</div></div>

                <div class="mt-3 d-grid">
                  <button cButton color="warning" type="button" [disabled]="!cart.length || isSaving" (click)="completePurchase()">Completar Compra</button>
                </div>
              </c-card-body>
            </c-card>
          </div>
        </div>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>

