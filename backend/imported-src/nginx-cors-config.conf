# Nginx Configuration for CORS Support
# This file needs to be added to your nginx server configuration
# Contact your hosting provider (servicio-online.net) to apply this

location /backend/public/api {
    # Allow all HTTP methods including OPTIONS, PUT, DELETE
    if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '$http_origin' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization, X-Requested-With, X-HTTP-Method-Override' always;
        add_header 'Access-Control-Allow-Credentials' 'true' always;
        add_header 'Access-Control-Max-Age' 86400 always;
        add_header 'Content-Length' 0;
        add_header 'Content-Type' 'text/plain charset=UTF-8';
        return 204;
    }

    # For other requests, pass to PHP-FPM
    try_files $uri $uri/ /backend/public/index.php?$query_string;

    # Pass to PHP processor
    location ~ \.php$ {
        include fastcgi_params;
        fastcgi_pass unix:/var/run/php/php-fpm.sock;  # Adjust path as needed
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }
}

# Alternative: Add this to the server block to allow all methods globally
# add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS' always;
# add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization, X-Requested-With, X-HTTP-Method-Override' always;
